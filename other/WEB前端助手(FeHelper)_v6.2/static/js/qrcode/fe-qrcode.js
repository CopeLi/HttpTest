baidu.qrcode=(function(){var h="";var g=function(){$("#preview > img").attr("src","");var j=$("#tabs").tabs("option","selected");switch(j){case 0:h=$.trim($("#tabs-1 #tab1_text").attr("value"));break;case 1:h="tel:"+$.trim($("#tabs-2 #tab2_telno").attr("value"));break;case 2:h=$("#tabs-3 [name=tab3_type]:checked").attr("value")+":"+$.trim($("#tabs-3 #tab3_telno").attr("value"))+":"+$.trim($("#tabs-3 #tab3_message").attr("value"));break;case 3:h="mailto:"+$.trim($("#tabs-4 #tab4_email").attr("value"));break;case 4:h="BEGIN:VCARD\nVERSION:3.0\n";var i=$.trim($("#tabs-5 #tab5_FormattedName").attr("value"));h+=i?("FN:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_Telephone").attr("value"));h+=i?("TEL:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_Email").attr("value"));h+=i?("EMAIL:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_X-MSN").attr("value"));h+=i?("X-MSN:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_Organization").attr("value"));h+=i?("ORG:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_Title").attr("value"));h+=i?("TITLE:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_Address").attr("value"));h+=i?("ADR:"+i+"\n"):"";i=$.trim($("#tabs-5 #tab5_URL").attr("value"));h+=i?("URL:"+i+"\n"):"";h+="END:VCARD";break}return h};var d=function(){var k=$("#opt_width").val();var l=$("#opt_fc").val();var j={render:"canvas",minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:+k||200,fill:l,background:null,radius:0,quiet:0,text:h,mode:0,mSize:0.15,mPosX:0.5,mPosY:0.5,label:"FH",fontname:"sans",fontcolor:"#f00",image:false};var i=$("input[name=qr_icon]:checked").val();if(i==1){j.mode=4;j.image=$("#logo_default")[0]}else{if(i==2){j.mode=4;j.image=$("#logo")[0]}}return j};var b=function(){h=g();if(h){$("#preview").html("").qrcode(d())}else{$("#preview").html("再在输入框里输入一些内容，就能生成二维码了哦~")}$("#fieldset_qr").show()};var c=function(j){if(/image\//.test(j.type)){var i=new FileReader();i.onload=function(k){$("#logo").attr("src",k.target.result);b()};i.readAsDataURL(j)}else{alert("请选择图片文件！")}};var a=function(){$(document).bind("drop",function(j){j.preventDefault();j.stopPropagation();var i=j.originalEvent.dataTransfer.files;if(i.length){c(i[0])}}).bind("dragover",function(i){i.preventDefault();i.stopPropagation()})};var e=function(){var i="tabs-1";$("#tabs").tabs().bind("tabsselect",function(j,k){i=k.panel.id}).tabs("select",0);$("#confirm_button").button().click(function(){b()});$("#opt_fc").colorpicker({fillcolor:true,success:function(k,j){b()}});$("#remove_icon,#default_icon").click(function(j){b()});$("#upload_icon").click(function(j){$("#file").trigger("click")});$("#file").change(function(j){if(this.files.length){c(this.files[0]);this.value=""}});a()};var f=function(){chrome.runtime.onMessage.addListener(function(j,i,k){if(j.type==MSG_TYPE.TAB_CREATED_OR_UPDATED&&j.event=="qrcode"){if(j.content){document.getElementById("tab1_text").value=(j.content);setTimeout(b,50)}}});$(function(){e();$("#tab1_text").focus()})};return{init:f}})();baidu.qrcode.init();